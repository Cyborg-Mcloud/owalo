<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://maps.googleapis.com https://fonts.googleapis.com">
	
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Owalo</title>

	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFY47FE__z9AvRLBoYG0T2XeOTiHdwzOQ&libraries=places"></script>
  </head>
  <style>
	body {color:black; margin:0px; padding:0px; border:0px;}
	a {text-decoration:none; color:white;}
  </style>
  <body>
  <div id='heading_div'></div>
<div id='map'>asdasdas </div>
<div id='text'></div>
  <div id='geopos' style='border:1px solid black; width:200px; height:200px;'></div>
  
<script>

   var watchID = null;
   var watchID2 = null;

var MyLat;
var MyLong;
var MyAlt;
var MyHead;
var MySpeed;
var MyAcc;

function onDeviceReady() 
	{
    document.removeEventListener('deviceready', onDeviceReady, false);

	console.log("device ready, getting position");
	navigator.geolocation.getCurrentPosition(onSuccess, onError, {enableHighAccuracy: true,  maximumAge:0});
	var opts = { timeout: 5000, enableHighAccuracy: true, maximumAge:0};
	watchID = navigator.geolocation.watchPosition(onSuccess, onError, opts);
	console.log("compass init");
	//navigator.Compass.getCurrentHeading(onCompassSuccess, onError);

	 var moptions = { frequency: 1000 };

	watchID2 = navigator.compass.watchHeading(onCompassSuccess, onError, moptions);


	//setTimeout("StartWebView();",200); 
    }


function onSuccess(position) 
	{
	console.log("on GPS success");
		
	MyLat=position.coords.latitude ;
	MyLong=position.coords.longitude ;
	MyAlt=position.coords.altitude ;
	MyHead=position.coords.heading ;
	MySpeed=position.coords.speed ;
	MyAcc=position.coords.accuracy;

	console.log(MyLat+ " - "+MyLong);
document.getElementById("text").innerHTML="";
initialize();

document.getElementById('geopos').innerHTML = 'Latitude: '           + MyLat             + '<br />' +
                            'Longitude: '          + MyLong            + '<br />'+
							'Accuracy: '          + MyAcc            + '<br />';

    }

document.addEventListener("deviceready", onDeviceReady, false);

function onCompassSuccess(heading) {
       // alert('Heading: ' + heading.magneticHeading);
	   console.log("heading: "+heading.magneticHeading);
document.getElementById("heading_div").innerHTML=heading.magneticHeading;
    }


function onError()
	{
	alert("error");
	}



var map;
var service;
var infowindow;

function initialize() {
 // var pyrmont = new google.maps.LatLng(41.707265,44.769453622);

var pyrmont = new google.maps.LatLng(MyLat,MyLong);
console.log("initializing");


  map = new google.maps.Map(document.getElementById('map'), {
      center: pyrmont,
      zoom: 15
    });

  var request = {
    location: pyrmont,
    radius: '500'
  };

  service = new google.maps.places.PlacesService(map);
  service.nearbySearch(request, callback);
}

function callback(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    for (var i = 0; i < results.length; i++) {
      var place = results[i];
    //  createMarker(results[i]);
	document.getElementById("text").innerHTML+="<img width=20px src='"+results[i].icon+"'> "+results[i].name+" | "+results[i].geometry.viewport.f.b+ " / "+results[i].geometry.viewport.b.b+"<BR>";

	//alert(results[i].name);
	console.log(results[i].geometry.viewport.b);
	 console.log(results[i]);
    }
  }
}



</script>

</body>



</html>
